<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>omniGlass: Omniglass documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">omniGlass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Omniglass documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Welcome to the documentation of the OmniGlass.</p>
<p>Omniglass is a touchpad gesture detection library that aims to stay as far out of the way as possible, allowing the user code to just ask for the touchpoints or gesture parameters.</p>
<p>Start by checking out the reference for <code><a class="el" href="omniglass_8h.html" title="the omniglass public API definition.">omniglass.h</a></code> .</p>
<p>To start using the library on your application, <b>you can either carefully read this short introduction or skip to the examples at the end.</b></p>
<h2><a class="anchor" id="autotoc_md0"></a>
An introduction to gesture detection with omniglass</h2>
<h3><a class="anchor" id="autotoc_md1"></a>
Linking binaries and including headers</h3>
<ul>
<li>All the functionality is encapsulated in the shared library <code>libomniglass</code>. You can link with it on your average c compiler via the flag <code>-lomniglass</code>.</li>
<li>The current linux implementation also uses <code>omniglass_core.lua</code> and <code>omniglass_linux.lua</code>. You don't need to directly load those, but make sure they are properly installed before proceeding.</li>
</ul>
<p>Include <code>omniGlass/constants.h</code> and <code>omniGlass/omniglass.h</code> on your application. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;omniGlass/constants.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;omniGlass/omniglass.h&gt;</span></div>
</div><!-- fragment --><p> <code><a class="el" href="constants_8h.html" title="mostly enumerations for use in flow control">constants.h</a></code> gathers all the enums in one spot; <code><a class="el" href="omniglass_8h.html" title="the omniglass public API definition.">omniglass.h</a></code> is the main header file that contains everything you'll actually use.</p>
<p>Here is a typical build command for a single-source application that uses omniglass and only omniglass: </p><div class="fragment"><div class="line">gcc -lomniglass_linux goofyahhslider.c -o goofyahhslider.elf</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md2"></a>
Starting up the library</h3>
<p>Omniglass holds all the state on an opaque handle. You must initialize it with <code>omniglass_init</code>: </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structomniglass.html">omniglass</a> *handle;</div>
<div class="line"><span class="keywordtype">int</span> init_result = <a class="code" href="omniglass_8h.html#a9cfe0d7ae7def6abc1704f3c78d62894">omniglass_init</a>(&amp;handle);</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="omniglass_8h.html#a9cfe0d7ae7def6abc1704f3c78d62894">omniglass_init</a>(&amp;handle) != OMNIGLASS_RESULT_SUCCESS){</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;could not initialize omniglass.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="ttc" id="aomniglass_8h_html_a9cfe0d7ae7def6abc1704f3c78d62894"><div class="ttname"><a href="omniglass_8h.html#a9cfe0d7ae7def6abc1704f3c78d62894">omniglass_init</a></div><div class="ttdeci">omniglass_operation_results omniglass_init(struct omniglass **handle)</div><div class="ttdef"><b>Definition:</b> omniglass.c:255</div></div>
<div class="ttc" id="astructomniglass_html"><div class="ttname"><a href="structomniglass.html">omniglass</a></div><div class="ttdef"><b>Definition:</b> omniglass.c:17</div></div>
</div><!-- fragment --><p> Notice how the init process itself returns a <b>status code</b> <code>init_result</code>. Checking this against the enums lets the application bail out if initialization failed. And fail it can, in many ways, including:</p><ul>
<li>there is no touchpad.</li>
<li>a bug in the touchpad driver (or on omniglass' own platform layer) made the platform abort initialization.</li>
<li>the user or application does not have permission to access the touchpads available.</li>
<li>the user wanted a certain touchpad, and only this touchpad, but it was not available when the initialization started.</li>
</ul>
<p><b>Status codes</b> are returned by most functions in the OmniGlass API. These codes are enumerated for use in error-checking patterns.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Registering gestures (with callbacks)</h3>
<p>you can register gestures to be detected by providing a callback. the criteria of the gesture (if any) and an optional pointer to passthrough data you intend to let the callback use when it's called. The passthrough is just a convenience to avoid having to use global variables (usually undesirable for multithreaded code).</p>
<p>Here is an example of a callback meant for the edge slide gesture: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> on_edge_slide(<span class="keywordtype">double</span> value, <span class="keywordtype">void</span> *data) {</div>
<div class="line">    <span class="keywordflow">if</span> (value &lt; 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;moved on edge, negative\t\t%g\n&quot;</span>, value);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;moved on edge, positive\t\t%g\n&quot;</span>,value);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">}</div>
</div><!-- fragment --><p>And here is a piece of code that registers an edge slide gesture against this callback: </p><div class="fragment"><div class="line"><a class="code" href="omniglass_8h.html#a66ff546fe0533d3fc2ab6c01e6571f9f">omniglass_listen_gesture_edge</a>(handle,&amp;on_edge_slide, OMNIGLASS_EDGE_LEFT, NULL);</div>
<div class="ttc" id="aomniglass_8h_html_a66ff546fe0533d3fc2ab6c01e6571f9f"><div class="ttname"><a href="omniglass_8h.html#a66ff546fe0533d3fc2ab6c01e6571f9f">omniglass_listen_gesture_edge</a></div><div class="ttdeci">omniglass_gesture_operation_result omniglass_listen_gesture_edge(struct omniglass *handle, omniglass_callback_edge callback, omniglass_touchpad_edge edge, void *passthrough)</div><div class="ttdef"><b>Definition:</b> omniglass.c:81</div></div>
</div><!-- fragment --><p> Omniglass will keep track of the gesture and fire the callback for you when two conditions are met:</p><ul>
<li>the gesture has happened or some part of it changed (progress, distance, finger count, whatever).</li>
<li>you called <code><a class="el" href="omniglass_8h.html#a410372cd764e9b02f866c6004c94243c">omniglass_step()</a></code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md4"></a>
Registering gestures (with parameter outputs)</h3>
<p>You can also register gestures by providing a pointer to a struct that will hold <b>parameters</b>: values (usually numeric) bundled together telling everything you need to know about a gesture. The exact type of the struct varies for each gesture and its data will reflect the relevant variables of the representation of the gesture selected. Example: a struct for a finger slide may be registered against a finger slide structure, which will hold updated values of how many fingers are sliding since the last time you checked for a finger slide.</p>
<p>(TODO: properly elaborate on this one with code example)</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Running the gesture detection engine</h3>
<p>To detect the gestures you registered when they happen, you must regularly run iterations of the gesture engine: </p><div class="fragment"><div class="line"><a class="code" href="omniglass_8h.html#a410372cd764e9b02f866c6004c94243c">omniglass_step</a>(handle);</div>
<div class="ttc" id="aomniglass_8h_html_a410372cd764e9b02f866c6004c94243c"><div class="ttname"><a href="omniglass_8h.html#a410372cd764e9b02f866c6004c94243c">omniglass_step</a></div><div class="ttdeci">int omniglass_step(struct omniglass *handle)</div><div class="ttdef"><b>Definition:</b> omniglass.c:35</div></div>
</div><!-- fragment --><p> This function checks for all the gestures registered, calls the callbacks for the gestures actually happening and updates the parameters of each gesture.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
A small code example using callbacks (based on tests/edge_swipe.c ):</h2>
<p>This example puts together the code snippets shown in the introduction, using callbacks. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;omniGlass/constants.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;omniGlass/omniglass.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> on_edge_slide(<span class="keywordtype">double</span> value, <span class="keywordtype">void</span> *data) {</div>
<div class="line">    <span class="keywordflow">if</span> (value &lt; 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;moved on edge, negative\t\t%g\n&quot;</span>, value);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;moved on edge, positive\t\t%g\n&quot;</span>,value);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structomniglass.html">omniglass</a> *handle;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="omniglass_8h.html#a9cfe0d7ae7def6abc1704f3c78d62894">omniglass_init</a>(&amp;handle) != OMNIGLASS_RESULT_SUCCESS){</div>
<div class="line">        fprintf(stderr,<span class="stringliteral">&quot;could not initialize omniglass.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="omniglass_8h.html#a66ff546fe0533d3fc2ab6c01e6571f9f">omniglass_listen_gesture_edge</a>(handle,&amp;on_edge_slide, OMNIGLASS_EDGE_LEFT, NULL);</div>
<div class="line">    fflush(stdout);</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;starting event loop\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        usleep(1000);</div>
<div class="line">        <a class="code" href="omniglass_8h.html#a410372cd764e9b02f866c6004c94243c">omniglass_step</a>(handle);</div>
<div class="line">        fflush(stdout);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
